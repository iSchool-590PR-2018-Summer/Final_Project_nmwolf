# Title: Testing City Hotspots Using Monte Carlo Simulations of Pedestrian Traffic

## Team Member(s):

Neha Tanej

Nicholas Wolf

# Monte Carlo Simulation Scenario & Purpose:

Businesses and city planners often need to address where best to locate ameneties in order to maximize foot traffic. One way to solve this problem is to run multiple simulations of pedestrians traversing a city grid, treating such a grid as a network of pathways connecting businesses, residences, and occasionally blocked paths, and looking at where pedestrians frequently cross paths.

However, such simulations can be time consuming if a model of a city grid must be constructed for each scenario. Moreover, the goal is to present multiple layout possibilities for a section of the city and to quickly assess what locations will get the most traffic.

This program will handle both the rapid construction of a city model and the modeling of pathways of pedestrians seeking to minimize walking distances from start to destination, all for the purpose of seeking the maximal place to locate a business or amenity to maximize foot traffic.



## Simulation's variables of uncertainty

Uncertainty for this simulation occurs in two places: the construction of the city model and the pathways of pedestrians.

 1. Each city model generated by the program has a set proportion of businesses, residences, walkways (throughways), and blocked path (e.g. construction zones, closed paths). However, the simulation will use pseudo-random numbers to locate the placement of each of those elements when it constructs the model city grid.

 2. Pedestrians who are initiated for the purpose of the model will be assigned a starting location (a residence) and a destination (a business) using a random sample without replacement of all available residences/businesses in the city model.

The idea behind these parameters, as with any Monte Carlo simulation, is to consider a wider range of possibilities then a simulation using a pre-determined layout or pedestrian behavior might uncover. Using pseudo-randomly generated layouts and pedestrian pathways widens the number of cases to consider.


## Hypothesis or hypotheses before running the simulation:

Our central question for this particular simulation was whether the nodes/locations with the optimal pedestrian traffic would be those that were also residences and businesses, or near them, or whether walkways would be more likely to prove to be high traffic points.

To test this multiple simulations were run on a several city grids, each with a different proportion of businesses, residences, and walkways.

## Analytical Summary of your findings:



## Instructions on how to use the program:

This program is reliant on having the following modules installed:

[```networkx```](https://networkx.github.io/documentation/latest/install.html) (>2.0)

[```beautifultable```](https://pypi.org/project/beautifultable/)

Run `ped_collisions.py` within directory to set parameters and run simulation.

User will be prompted for the number of simulations to run, size of city grid to model, and number of pedestrians.

Note that simulations iterations that are too high (40, 50, 60, etc.) may take a while because of the necessary performance requirements of `networkx` and network traversing.

Similarly, a city grid of too large a size will prove unwieldy. It is recommended that a grid be set at between 10 and 40 "blocks" in square length.

Because each pedestrian needs a start residence, and because the proportion of residences in each city grid is preset, a simulation cannot be run with too many pedestrians. The program will prompt the user when too high of parameters are chosen in any of the above items.

Once run, the program will output a basic ASCII rendition of the city grid generated, like this:

![Sample Table](https://github.com/nmwolf/Final_Project/blob/master/imgs/sample-city-grid.png)

R = Residences

B = Businesses

`*` = Blockage

| | = Walkway

An image (.png) of the network graph will also be generated, along with a Gephi file (.gefx) to assist users with a richer view of the grid being modeled.

Example:

![Sample Network Graph](https://github.com/nmwolf/Final_Project/blob/master/imgs/network-image-example.png)

## Program structure

The simulation relies on several Python classes. The `City` object is a `networkx` graph representing the city layout to be tested. Each `City` consists of a series of `CityLocation` nodes; a `CityLocation` is connected to other nodes, and has attributes such as a `GeoLocation` (latitude-longitude) and type (residence, business, walkway, blockage).

The `Pedestrian` object has a start (`Pedestrian.start_location`), an end (`Pedestrian.end_location`), and a shortest simple path (`networkx` simple paths) between those two points (`Pedestrian.list_short_paths`).

When the simulation is run, it first builds the `City` object, then a set of `Pedestrian` objects. Lastly, it investigates the relationship of each pedestrian's paths to each others given the contours of the city.


## Program Results

When run, the program will generate for the user a table summarizing each simulation like this example:

![Sample Table](https://github.com/nmwolf/Final_Project/blob/master/imgs/sample-results.png)


In this case, the top location for pedstrian traffic is located at the node located at lat-long (8, 4)

Each row represents one simuluation of *n* pedestrians (in this case, 4), on a city grid of a size *k*, here 10.

The program looks at which locations (nodes, i.e. `CityLocation`) occurred most often in shortest pathways (the column "Number of Times Node in a Pedestrian Path")

It also looks at nodes that occurred frequently in the same order location of many paths, i.e. occurred frequently in the first, second, third, fourth, etc. "step" of many pedestrians' pathways. This indicates literal collision -- many pedestrians are hitting that same location at the same stage in his or her journey, a further indication of a "hotspot." This number is recorded in the final column.


## All Sources Used:

